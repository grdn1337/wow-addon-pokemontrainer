<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/
..\FrameXML\UI.xsd">
	
	<Script file="FrameCombatDisplay.lua" />
	
	<Button name="PTButtonTemplate" virtual="true">
		<Size>
			<AbsDimension x="22" y="22" />
		</Size>
	</Button>
	
	<Texture name="PTTextureBonusTemplate" file="Interface\PetBattles\BattleBar-AbilityBadge-Neutral" inherits="PTButtonTemplate" virtual="true" />
	
	<Texture name="PTTextureSpeedTemplate" file="Interface\PetBattles\PetBattle-StatIcons" virtual="true">
		<Size>
			<AbsDimension x="11" y="11" />
		</Size>
		<TexCoords left="0" right="0.5" top="0.5" bottom="1" />
	</Texture>
	
	<Button name="PTButtonEnemyTemplate" inherits="PTButtonTemplate" virtual="true">
		<Layers>
			<Layer level="BACKGROUND">
				<Texture parentKey="Icon" setAllPoints="true">
					<TexCoords left="0.078125" right="0.921875" top="0.078125" bottom="0.921875" />
				</Texture>
			</Layer>
			<Layer level="BORDER">
				<Texture parentKey="Border" file="Interface\PetBattles\PetBattleHud">
					<Size>
						<AbsDimension x="26" y="26" />
					</Size>
					<TexCoords left="0.82519531" right="0.87109375" top="0.88085938" bottom="0.97265625" />  
					<Anchors>
						<Anchor point="CENTER" />
					</Anchors>  
				</Texture>
				<Texture parentKey="Dead" file="Interface\PetBattles\PetBattleHud" hidden="true">
					<Size x="26" y="26" />	
					<TexCoords left="0.77734375" right="0.82324219" top="0.88085938" bottom="0.97265625" />
					<Anchors>
						<Anchor point="CENTER" />
					</Anchors>
				</Texture>
			</Layer>
		</Layers>
	</Button>
	
	<Button name="PTButtonAbilityTemplate" inherits="PTButtonTemplate" virtual="true" hidden="true">
		<Scripts>
			<OnEvent>
				local db = PT:GetModule("FrameCombatDisplay").db.profile;
				if( not db.cd_text and not db.cd_highlight ) then
					return;
				end
				
				-- love the frame widget id system :D
				local side = self:GetParent():GetParent():GetID();
				local pet  = self:GetParent():GetID();
				
				local available, cdleft = PT:GetAbilityCooldown(side, pet, self:GetID());
				
				if( available ) then
					self.Cooldown:SetText("");
					self.CooldownBG:Hide();
				else
					if( db.cd_text ) then
						self.Cooldown:SetTextColor(db.cd_text_r, db.cd_text_g, db.cd_text_b, db.cd_text_a);
						self.Cooldown:SetText(cdleft > 0 and cdleft or "");
					end
					if( db.cd_highlight ) then
						self.CooldownBG:SetTexture(db.cd_highlight_r, db.cd_highlight_g, db.cd_highlight_b, db.cd_highlight_a);
						self.CooldownBG:Show();
					else
						self.CooldownBG:Hide();
					end
				end
			</OnEvent>
			<OnShow>
				local db = PT:GetModule("FrameCombatDisplay").db.profile;
				
				-- during the battle opening scene, buttons shall glow red until the player can actually use them - if highlights are enabled
				self.Cooldown:SetText("");
				
				if( db.cd_highlight ) then
					self.CooldownBG:SetTexture(db.cd_highlight_r, db.cd_highlight_g, db.cd_highlight_b, db.cd_highlight_a);
					self.CooldownBG:Show();
				else
					self.CooldownBG:Hide();
				end
			</OnShow>
			<OnEnter>				
				local parent = self:GetParent();
				local master = parent:GetParent();
				
				_G.PetBattleAbilityTooltip_SetAbility(master:GetID(), parent:GetID(), self:GetID());
				
				if( PT.BattleFrame_GetTooltipPosition() ) then
					_G.PetBattleAbilityTooltip_Show("TOPLEFT", self, "RIGHT", 10, 0);
				else
					_G.PetBattleAbilityTooltip_Show("TOPRIGHT", self, "LEFT", -10, 0);
				end
			</OnEnter>
			<OnLeave>
				_G.PetBattlePrimaryAbilityTooltip:Hide();
			</OnLeave>
		</Scripts>
		<Layers>
			<Layer level="OVERLAY">
				<Texture parentKey="CooldownBG" setallpoints="true" hidden="true">
				</Texture>
				<FontString parentKey="Cooldown" inherits="SystemFont_Outline" justifyH="CENTER" justifyV="CENTER">
					<Anchors>
						<Anchor point="CENTER" />
					</Anchors>
				</FontString>
			</Layer>
			<Layer level="ARTWORK">
				<Texture parentKey="Bonus1" inherits="PTTextureBonusTemplate">
					<Anchors>
						<Anchor point="LEFT" relativePoint="RIGHT" x="3" y="0" />
					</Anchors>
				</Texture>
				<Texture parentKey="Bonus2" inherits="PTTextureBonusTemplate">
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.Bonus1" relativePoint="RIGHT" x="3" y="0" />
					</Anchors>
				</Texture>
				<Texture parentKey="Bonus3" inherits="PTTextureBonusTemplate">
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.Bonus2" relativePoint="RIGHT" x="3" y="0" />
					</Anchors>
				</Texture>
			</Layer>
		</Layers>
	</Button>
	
	<Frame name="PTFrameHeaderTemplate" virtual="true">
		<Frames>
			<Button parentKey="Enemy1" inherits="PTButtonEnemyTemplate">
				<Anchors>
					<Anchor point="TOPLEFT">
						<Offset>
							<AbsDimension x="25" y="0" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
			<Button parentKey="Enemy2" inherits="PTButtonEnemyTemplate">
				<Anchors>
					<Anchor point="LEFT" relativePoint="RIGHT" relativeKey="$parent.Enemy1">
						<Offset>
							<AbsDimension x="3" y="0" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
			<Button parentKey="Enemy3" inherits="PTButtonEnemyTemplate">
				<Anchors>
					<Anchor point="LEFT" relativePoint="RIGHT" relativeKey="$parent.Enemy2">
						<Offset>
							<AbsDimension x="3" y="0" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
		</Frames>
	</Frame>
	
	<Frame name="PTFramePetTemplate" virtual="true">
		<Animations>
			<AnimationGroup parentKey="animHide">
				<Alpha change="-1" duration="0.5" order="1" step="0.02" />
				<Scripts>
					<OnFinished>
						PT.BattleFrame_Pet_HideFinished(self);
					</OnFinished>
				</Scripts>
			</AnimationGroup>
			<AnimationGroup parentKey="animShow">
				<Alpha change="1" duration="0.5" order="1" step="0.02" />
				<Scripts>
					<OnStop>
						PT.BattleFrame_Pet_ShowFinished(self);
					</OnStop>
					<OnFinished>
						PT.BattleFrame_Pet_ShowFinished(self);
					</OnFinished>
					<OnUpdate>
						PT.BattleFrame_Pet_WhilePlaying(self);
					</OnUpdate>
				</Scripts>
			</AnimationGroup>
		</Animations>
		<Layers>
			<Layer level="BACKGROUND">
				<Texture parentKey="activeBG" alpha="0">
					<Anchors>
						<Anchor point="LEFT" x="-4" y="0" />
						<Anchor point="RIGHT" x="2" y="0" />
						<Anchor point="TOP" x="0" y="4" />
						<Anchor point="BOTTOM" x="0" y="-4" />
					</Anchors>
					<Animations>
						<AnimationGroup parentKey="animActive">
							<Alpha change="1" duration="3" order="1" step="0.02" smoothing="IN_OUT" />
							<Alpha change="-1" duration="3" order="2" step="0.02" smoothing="IN_OUT" />
							<Scripts>
								<OnPlay>
									self:GetParent():SetAlpha(0);
								</OnPlay>
								<OnStop>
									self:GetParent():SetAlpha(0);
								</OnStop>
								<OnFinished>
									self:Play();
								</OnFinished>
							</Scripts>
						</AnimationGroup>
					</Animations>
				</Texture>
			</Layer>
			<Layer level="ARTWORK">
				<Texture parentKey="Type" inherits="PTButtonTemplate">
					<TexCoords left="0.79687500" right="0.49218750" top="0.50390625" bottom="0.65625000" />
					<Anchors>
						<Anchor point="TOPLEFT" relativePoint="TOPLEFT" x="0" y="1" />
					</Anchors>
				</Texture>
				<Texture parentKey="SpeedBG1" inherits="PTTextureBonusTemplate">
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.Type" relativePoint="RIGHT" x="3" y="0" />
				</Anchors>
				</Texture>
				<Texture parentKey="SpeedBG2" inherits="PTTextureBonusTemplate">
					<Anchors>
				<Anchor point="LEFT" relativeKey="$parent.SpeedBG1" relativePoint="RIGHT" x="3" y="0" />
					</Anchors>
				</Texture>
				<Texture parentKey="SpeedBG3" inherits="PTTextureBonusTemplate">
					<Anchors>
						<Anchor point="LEFT" relativeKey="$parent.SpeedBG2" relativePoint="RIGHT" x="3" y="0" />
					</Anchors>
				</Texture>
			</Layer>
			<Layer level="OVERLAY">
				<Texture parentKey="Speed1" inherits="PTTextureSpeedTemplate">
					<Anchors>
						<Anchor point="CENTER" relativeKey="$parent.SpeedBG1" />
					</Anchors>
				</Texture>
				<Texture parentKey="Speed2" inherits="PTTextureSpeedTemplate">
					<Anchors>
						<Anchor point="CENTER" relativeKey="$parent.SpeedBG2" />
					</Anchors>
				</Texture>
				<Texture parentKey="Speed3" inherits="PTTextureSpeedTemplate">
					<Anchors>
						<Anchor point="CENTER" relativeKey="$parent.SpeedBG3" />
					</Anchors>
				</Texture>
			</Layer>
		</Layers>
		<Frames>
			<Button parentKey="Button" hidden="false">
				<Size>
					<AbsDimension x="30" y="30" />
				</Size>
				<Layers>
					<Layer level="BACKGROUND">
						<Texture parentKey="Icon" setAllPoints="true">
							<TexCoords left="0.078125" right="0.921875" top="0.078125" bottom="0.921875" />
						</Texture>
					</Layer>
					<Layer level="BORDER">
						<Texture parentKey="Border" file="Interface\PetBattles\PetBattleHud">
							<Size>
								<AbsDimension x="36" y="36" />
							</Size>
							<TexCoords left="0.82519531" right="0.87109375" top="0.88085938" bottom="0.97265625" />  
							<Anchors>
								<Anchor point="CENTER" />
							</Anchors>  
						</Texture>
						<Texture parentKey="Dead" file="Interface\PetBattles\PetBattleHud" hidden="true">
							<Size x="36" y="36" />	
							<TexCoords left="0.77734375" right="0.82324219" top="0.88085938" bottom="0.97265625" />
							<Anchors>
								<Anchor point="CENTER" />
							</Anchors>
						</Texture>
					</Layer>
					<Layer level="OVERLAY">
						<FontString parentKey="Level" inherits="SystemFont_Outline" justifyH="LEFT" justifyV="TOP">
							<Anchors>
								<Anchor point="TOP" relativePoint="BOTTOM" y="-2" />
							</Anchors>
						</FontString>
					</Layer>
				</Layers>
			</Button>
			<Button parentKey="Ability1" id="1" inherits="PTButtonAbilityTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeKey="$parent.Type">
						<Offset>
							<AbsDimension x="0" y="-2" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
			<Button parentKey="Ability2" id="2" inherits="PTButtonAbilityTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeKey="$parent.Ability1">
						<Offset>
							<AbsDimension x="0" y="-2" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
			<Button parentKey="Ability3" id="3" inherits="PTButtonAbilityTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeKey="$parent.Ability2">
						<Offset>
							<AbsDimension x="0" y="-2" />
						</Offset>
					</Anchor>
				</Anchors>
			</Button>
		</Frames>
	</Frame>
	
	<Frame name="PTFrameTemplate" frameStrata="LOW" enablemouse="true" movable="true" clampedtoscreen="true" virtual="true">
		<Size>
			<AbsDimension x="98" y="319" />
		</Size>
		<Animations>
			<AnimationGroup parentKey="animHide">
				<Alpha change="-1" duration="1" order="1" step="0.02" />
				<Scripts>
					<OnFinished>
						self:GetParent():Hide();
					</OnFinished>
				</Scripts>
			</AnimationGroup>
			<AnimationGroup parentKey="animShow">
				<Alpha change="1" duration="1" order="1" step="0.02" />
				<Scripts>
					<OnFinished>
						self:GetParent():SetAlpha(1);
					</OnFinished>
				</Scripts>
			</AnimationGroup>
		</Animations>
		<Layers>
			<Layer level="ARTWORK">
				<Texture parentKey="bg">
					<Anchors>
						<Anchor point="LEFT" relativeTo="$parent" x="-4" y="0" />
						<Anchor point="RIGHT" relativeTo="$parent" x="2" y="0" />
						<Anchor point="TOP" relativeTo="$parent" x="0" y="-23" />
						<Anchor point="BOTTOM" relativeTo="$parent" x="0" y="-4" />
					</Anchors>
				</Texture>
			</Layer>
		</Layers>
		<Scripts>
			<OnLoad>
				PT.BattleFrame_OnLoad(self);
			</OnLoad>
			<OnShow>
				self.dragElapsed = 0;
				self.firstRound = 1;
				self.animDone = 0;
				
				PT.BattleFrame_Options_Apply(self);
			</OnShow>
			<OnEvent>
				PT.BattleFrame_OnEvent(self, event, ...)
			</OnEvent>
			<OnDragStart>
				PT.BattleFrame_StartDrag(self);
			</OnDragStart>	
			<OnDragStop>
				PT.BattleFrame_StopDrag(self);
			</OnDragStop>			
		</Scripts>
		<Frames>
			<Frame name="$parentHeader" inherits="PTFrameHeaderTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" x="0" y="1" />
				</Anchors>
				<Size>
					<AbsDimension x="98" y="22" />
				</Size>
			</Frame>
			<Frame name="$parentPet1" id="1" inherits="PTFramePetTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentHeader">
						<Offset>
							<AbsDimension x="0" y="-6" />
						</Offset>
					</Anchor>
				</Anchors>
				<Size>
					<AbsDimension x="98" y="94" />
				</Size>
			</Frame>
			<Frame name="$parentPet2" id="2" inherits="PTFramePetTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentPet1">
						<Offset>
							<AbsDimension x="0" y="-5" />
						</Offset>
					</Anchor>
				</Anchors>
				<Size>
					<AbsDimension x="98" y="94" />
				</Size>
			</Frame>
			<Frame name="$parentPet3" id="3" inherits="PTFramePetTemplate">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentPet2">
						<Offset>
							<AbsDimension x="0" y="-5" />
						</Offset>
					</Anchor>
				</Anchors>
				<Size>
					<AbsDimension x="98" y="94" />
				</Size>
			</Frame>
		</Frames>
	</Frame>
	
	<!-- Player Frame -->
	<Frame name="PTPlayer" hidden="true" inherits="PTFrameTemplate">
		<Anchors>
			<Anchor point="TOPLEFT" relativePoint="TOPLEFT" relativeTo="UIParent">
				<Offset>
					<AbsDimension x="200" y="-150" />
				</Offset>
			</Anchor>
		</Anchors>
	</Frame>
	
	<!-- Enemy Frame -->
	<Frame name="PTEnemy"  hidden="true" inherits="PTFrameTemplate">
		<Anchors>
			<Anchor point="TOPRIGHT" relativePoint="TOPRIGHT" relativeTo="UIParent">
				<Offset>
					<AbsDimension x="-200" y="-150" />
				</Offset>
			</Anchor>
		</Anchors>
	</Frame>
	
	
	
</Ui>